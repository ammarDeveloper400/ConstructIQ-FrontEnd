import React, { useEffect, useRef } from "react";
import { useSidebar } from "../context/SidebarContext";
import UserDropdown from "../components/header/UserDropdown";
import { IoIosArrowBack, IoIosArrowForward } from "react-icons/io";

const AppHeader: React.FC = () => {
  const { isMobileOpen, toggleSidebar, toggleMobileSidebar } = useSidebar();

  const handleToggle = () => {
    if (window.innerWidth >= 1024) {
      toggleSidebar();
    } else {
      toggleMobileSidebar();
    }
  };

  const inputRef = useRef<HTMLInputElement>(null);

  useEffect(() => {
    const handleKeyDown = (event: KeyboardEvent) => {
      if ((event.metaKey || event.ctrlKey) && event.key === "k") {
        event.preventDefault();
        inputRef.current?.focus();
      }
    };

    document.addEventListener("keydown", handleKeyDown);
    return () => {
      document.removeEventListener("keydown", handleKeyDown);
    };
  }, []);

  return (
    <header className="sticky top-0 z-50 w-full bg-white border-gray-200 dark:border-gray-800 dark:bg-gray-900 lg:border-b">
      <div className="flex flex-col items-center justify-between w-full lg:flex-row lg:px-6">
        <div className="flex items-center justify-between w-full gap-2 px-3 py-1 md:py-3 border-b border-gray-200 dark:border-gray-800 sm:gap-4 lg:justify-normal lg:border-b-0 lg:px-0 lg:py-4">
          {/* Left section (Toggle button) */}
          <div className="flex items-center gap-2 sm:gap-4">
            <button
              className="flex items-center justify-center w-10 h-10 text-gray-500 dark:text-gray-400 lg:hidden"
              onClick={handleToggle}
              aria-label="Toggle Sidebar"
            >
              {isMobileOpen ? (
                <IoIosArrowBack size={28} />
              ) : (
                <IoIosArrowForward size={28} />
              )}
            </button>
          </div>

          <div className="md:hidden block">
            <div className="text-[#1F1F1F] dark:text-white light:text-black">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="217"
                height="26"
                viewBox="0 0 217 41"
                fill="none"
              >
                <g clip-path="url(#clip0_2872_2243)">
                  <path
                    d="M6.92762 41C5.77274 41 4.64132 40.6903 3.65245 40.1033C3.17246 39.8548 2.73397 39.5342 2.35141 39.1525C1.97247 38.7743 1.65488 38.3422 1.40405 37.8632C0.812178 36.8746 0.5 35.742 0.5 34.5859V6.41407C0.5 2.87751 3.38359 0 6.92762 0H35.159C36.3174 0 37.4525 0.31152 38.4431 0.902148C38.9213 1.15244 39.3562 1.46937 39.7352 1.84751C39.7821 1.89433 39.8272 1.94115 39.8687 1.98977C40.1863 2.3265 40.4642 2.71725 40.6861 3.14581C40.9063 3.51495 41.0867 3.9021 41.2239 4.30006C41.4621 4.97712 41.5848 5.69019 41.5848 6.41407V34.5859C41.5848 38.1225 38.7012 41 35.1572 41H6.92762ZM35.159 37.3986C36.7126 37.3986 37.9776 36.1363 37.9776 34.5859V16.5916C36.4329 19.2458 34.4065 22.0351 32.0751 24.7199C31.2793 25.6365 30.4492 26.5386 29.6119 27.403C29.3557 27.6677 29.0814 27.9486 28.7945 28.2331C26.8023 30.221 24.7254 32.0542 22.6213 33.6784C21.784 34.323 20.954 34.9299 20.1528 35.4791C19.1404 36.1759 18.1263 36.8188 17.1284 37.3968H35.159V37.3986ZM5.42267 36.9628C5.82868 37.1555 6.35198 37.2528 6.97453 37.2528C7.80099 37.2528 8.77362 37.0853 9.86714 36.7558V22.2062C4.89214 28.9534 3.60193 34.0979 4.54388 36.0859C4.76583 36.437 5.06898 36.7396 5.42086 36.961L5.42267 36.9628ZM13.4779 35.2846C13.7396 35.1531 14.0012 35.0181 14.2611 34.8794C15.8725 34.0169 17.5453 32.9545 19.2379 31.721V12.1583C18.0884 13.1505 16.9498 14.2093 15.8436 15.3131C15.0316 16.1234 14.2358 16.9607 13.4779 17.7999V35.2846ZM22.8487 28.8453C23.9927 27.8567 25.1332 26.7979 26.2429 25.6887C27.0568 24.8766 27.8526 24.0393 28.6086 23.2019V5.7172C26.7608 6.64096 24.8264 7.83842 22.8487 9.28258V28.8453ZM6.92762 3.60139C5.37394 3.60139 4.10899 4.86367 4.10899 6.41407V24.4066C5.65545 21.7506 7.6819 18.9595 10.0115 16.2783C10.8001 15.3707 11.6283 14.4686 12.4746 13.597C12.7291 13.3341 13.0034 13.0532 13.2921 12.7669C15.2824 10.779 17.3594 8.94765 19.4653 7.31982C20.2773 6.69138 21.1073 6.08635 21.9338 5.51913C22.9479 4.82226 23.9603 4.17941 24.9563 3.60139H6.92762ZM32.2176 18.7884C36.0504 13.5682 38.2194 8.48847 37.7755 5.7046C37.7286 5.40568 37.651 5.14098 37.5427 4.91409C37.3262 4.57196 37.032 4.27485 36.6946 4.05516L36.6657 4.03716C36.2615 3.84448 35.74 3.74724 35.112 3.74724C34.2874 3.74724 33.3148 3.91471 32.2194 4.24604V18.7884H32.2176Z"
                    fill="currentColor"
                  />
                  <path
                    d="M63.2973 31.5947C61.1301 31.5947 59.2552 31.1121 57.6727 30.1469C56.0901 29.1817 54.8739 27.8366 54.024 26.1079C53.1741 24.3793 52.75 22.3715 52.75 20.081C52.75 17.7905 53.1741 15.7828 54.024 14.0541C54.8739 12.3254 56.0901 10.9803 57.6727 10.0151C59.2552 9.04997 61.1301 8.56738 63.2973 8.56738C65.847 8.56738 67.9186 9.17242 69.512 10.3807C71.1053 11.5889 72.1249 13.296 72.5724 15.5019H69.6076C69.2666 14.1243 68.5772 13.0169 67.536 12.1778C66.4948 11.3405 65.0819 10.9209 63.2973 10.9209C61.7238 10.9209 60.3487 11.2864 59.1704 12.0175C57.9903 12.7486 57.0826 13.7984 56.4456 15.1669C55.8086 16.5337 55.4892 18.1723 55.4892 20.081C55.4892 21.9898 55.8086 23.6266 56.4456 24.9951C57.0826 26.3618 57.9921 27.4116 59.1704 28.1445C60.3487 28.8756 61.7256 29.2412 63.2973 29.2412C65.0819 29.2412 66.4948 28.8324 67.536 28.0167C68.5772 27.201 69.2666 26.1133 69.6076 24.7574H72.5724C72.1267 26.8984 71.1071 28.5731 69.512 29.7832C67.9186 30.9914 65.847 31.5965 63.2973 31.5965V31.5947Z"
                    fill="currentColor"
                  />
                  <path
                    d="M82.1981 31.5947C80.7112 31.5947 79.3723 31.249 78.1831 30.5611C76.9921 29.8732 76.0574 28.8973 75.3789 27.635C74.6986 26.3745 74.3594 24.9051 74.3594 23.2305C74.3594 21.5558 74.704 20.0234 75.3952 18.7629C76.0845 17.5025 77.0318 16.5265 78.2318 15.8368C79.4318 15.1472 80.7762 14.8032 82.2631 14.8032C83.75 14.8032 85.1466 15.149 86.3268 15.8368C87.5069 16.5265 88.4417 17.5007 89.131 18.7629C89.8203 20.0252 90.1668 21.5036 90.1668 23.1999C90.1668 24.8961 89.8167 26.3763 89.1147 27.6368C88.4128 28.8991 87.4672 29.8732 86.2781 30.5629C85.0871 31.2508 83.7283 31.5965 82.1981 31.5965V31.5947ZM82.2288 29.306C83.1419 29.306 83.9918 29.0791 84.7785 28.6217C85.5635 28.1662 86.2023 27.4819 86.6913 26.5708C87.1803 25.6596 87.4239 24.536 87.4239 23.1999C87.4239 21.8637 87.1857 20.7149 86.7075 19.8128C86.2293 18.9124 85.6032 18.2335 84.8273 17.778C84.0513 17.3224 83.196 17.0937 82.2613 17.0937C81.3265 17.0937 80.5235 17.3224 79.7278 17.778C78.9302 18.2335 78.2932 18.9124 77.815 19.8128C77.3368 20.7149 77.0986 21.8439 77.0986 23.1999C77.0986 24.5558 77.3368 25.6596 77.815 26.5708C78.2932 27.4819 78.9193 28.1662 79.6953 28.6217C80.4712 29.0773 81.3157 29.306 82.2288 29.306Z"
                    fill="currentColor"
                  />
                  <path
                    d="M92.6484 31.2128V15.183H95.0701L95.1982 17.9813C95.7089 16.9855 96.4361 16.2058 97.3816 15.644C98.3272 15.0822 99.4063 14.8013 100.617 14.8013C101.828 14.8013 102.954 15.0516 103.869 15.5486C104.782 16.0474 105.495 16.8 106.004 17.8066C106.514 18.8132 106.769 20.0917 106.769 21.6385V31.211H104.091V21.9248C104.091 20.3132 103.735 19.1049 103.022 18.3C102.31 17.4951 101.306 17.0918 100.011 17.0918C99.1176 17.0918 98.3218 17.3096 97.6198 17.7436C96.9179 18.1776 96.3603 18.8042 95.9471 19.6199C95.532 20.4356 95.3263 21.4494 95.3263 22.6577V31.2128H92.6484Z"
                    fill="currentColor"
                  />
                  <path
                    d="M115.721 31.5947C114.404 31.5947 113.246 31.3714 112.248 30.9266C111.248 30.4819 110.458 29.8606 109.873 29.0665C109.288 28.2706 108.933 27.3324 108.805 26.252H111.546C111.652 26.803 111.874 27.3126 112.215 27.779C112.554 28.2454 113.016 28.6217 113.601 28.9081C114.186 29.1944 114.902 29.3366 115.752 29.3366C116.495 29.3366 117.111 29.225 117.6 29.0017C118.089 28.7784 118.455 28.4777 118.699 28.0959C118.942 27.7142 119.065 27.3 119.065 26.8553C119.065 26.198 118.912 25.6992 118.603 25.3607C118.295 25.0222 117.843 24.7521 117.248 24.5504C116.652 24.3487 115.931 24.174 115.081 24.0264C114.379 23.8985 113.689 23.7293 113.009 23.5168C112.329 23.3043 111.723 23.0234 111.192 22.6741C110.662 22.3247 110.241 21.8944 109.932 21.3866C109.624 20.877 109.471 20.2521 109.471 19.5102C109.471 18.5991 109.709 17.7888 110.187 17.0775C110.665 16.368 111.34 15.8116 112.212 15.4083C113.083 15.0049 114.103 14.8032 115.272 14.8032C116.993 14.8032 118.385 15.2174 119.448 16.0439C120.51 16.8704 121.137 18.0697 121.328 19.6381H118.682C118.576 18.8332 118.231 18.2011 117.647 17.7456C117.062 17.29 116.261 17.0613 115.241 17.0613C114.222 17.0613 113.484 17.263 112.962 17.6663C112.441 18.0697 112.181 18.5991 112.181 19.2563C112.181 19.6813 112.323 20.0576 112.61 20.3854C112.897 20.7149 113.327 20.9958 113.901 21.2281C114.474 21.4622 115.164 21.6531 115.972 21.8007C117.035 21.9916 118 22.2455 118.872 22.5642C119.744 22.8829 120.449 23.3547 120.992 23.9796C121.534 24.6044 121.804 25.4903 121.804 26.6356C121.804 27.6332 121.553 28.5011 121.055 29.243C120.556 29.9849 119.85 30.5629 118.935 30.9771C118.022 31.3912 116.948 31.5965 115.716 31.5965L115.721 31.5947Z"
                    fill="currentColor"
                  />
                  <path
                    d="M133.4 31.2129V15.1832H135.822L136.013 18.2371C136.374 17.5169 136.836 16.901 137.399 16.3932C137.962 15.8836 138.642 15.4929 139.438 15.2174C140.236 14.9419 141.143 14.8032 142.163 14.8032V17.6015H141.176C140.496 17.6015 139.848 17.6915 139.232 17.8716C138.615 18.0517 138.068 18.3434 137.59 18.7467C137.112 19.1501 136.74 19.6957 136.475 20.3854C136.21 21.075 136.076 21.9286 136.076 22.946V31.2147H133.398L133.4 31.2129Z"
                    fill="currentColor"
                  />
                  <path
                    d="M149.744 31.5943C148.512 31.5943 147.434 31.3512 146.509 30.8632C145.583 30.3752 144.872 29.6225 144.374 28.6051C143.874 27.5878 143.625 26.3147 143.625 24.7895V15.1846H146.303V24.5032C146.303 26.0932 146.653 27.2906 147.355 28.0973C148.057 28.9041 149.044 29.3056 150.32 29.3056C151.213 29.3056 152.02 29.0877 152.741 28.6538C153.463 28.2198 154.032 27.5932 154.447 26.7774C154.862 25.9617 155.067 24.9479 155.067 23.7397V15.1846H157.745V31.2143H155.324L155.165 28.4161C154.676 29.4137 153.954 30.1916 152.998 30.7534C152.041 31.3152 150.958 31.5961 149.746 31.5961L149.744 31.5943Z"
                    fill="currentColor"
                  />
                  <path
                    d="M168.138 31.5949C166.63 31.5949 165.274 31.2455 164.074 30.5451C162.874 29.8464 161.934 28.865 161.254 27.6027C160.574 26.3423 160.234 24.8837 160.234 23.2289C160.234 21.574 160.574 20.0596 161.254 18.8081C161.934 17.5567 162.874 16.5771 164.074 15.8658C165.274 15.1563 166.63 14.7998 168.138 14.7998C170.051 14.7998 171.644 15.2932 172.918 16.2782C174.192 17.2632 175.001 18.5831 175.34 20.2379H172.599C172.386 19.2421 171.866 18.4678 171.038 17.9168C170.21 17.3658 169.232 17.0903 168.106 17.0903C167.193 17.0903 166.348 17.319 165.572 17.7746C164.796 18.2301 164.17 18.9144 163.692 19.8255C163.214 20.7367 162.975 21.8603 162.975 23.1964C162.975 24.194 163.113 25.0782 163.39 25.8525C163.667 26.6268 164.038 27.2678 164.506 27.7774C164.973 28.287 165.52 28.6742 166.148 28.9389C166.774 29.2036 167.427 29.3368 168.107 29.3368C168.872 29.3368 169.562 29.2144 170.179 28.9713C170.794 28.7282 171.316 28.3626 171.74 27.8746C172.164 27.3867 172.451 26.814 172.601 26.1568H175.342C175.001 27.7684 174.189 29.0775 172.904 30.0841C171.617 31.0907 170.029 31.5949 168.14 31.5949H168.138Z"
                    fill="currentColor"
                  />
                  <path
                    d="M188.297 31.2131V8.95117H192.121V31.215H188.297V31.2131Z"
                    fill="currentColor"
                  />
                  <path
                    d="M212.236 29.5132L210.245 26.4502L208.226 23.344L207.448 22.1484H203.051L206.835 28.0636L208.822 31.1716L209.628 32.4321H214.132L212.236 29.515V29.5132ZM208.224 23.344L207.447 22.1484H203.049L206.833 28.0636C207.728 27.9232 208.538 27.6333 209.264 27.1903C209.61 26.9814 209.93 26.7401 210.224 26.47C210.229 26.4646 210.238 26.4574 210.244 26.4502L208.224 23.344ZM215.128 14.0867C214.215 12.358 212.929 11.0075 211.272 10.0315C209.616 9.05732 207.692 8.56934 205.503 8.56934C203.314 8.56934 201.461 9.05732 199.814 10.0315C198.168 11.0075 196.876 12.358 195.943 14.0867C195.008 15.8135 194.539 17.8123 194.539 20.0812C194.539 22.35 195.006 24.3812 195.943 26.1081C196.876 27.8368 198.168 29.1819 199.814 30.1471C201.461 31.1122 203.358 31.593 205.503 31.593C206.687 31.593 207.791 31.4526 208.822 31.168C209.695 30.9286 210.512 30.59 211.272 30.1453C211.592 29.958 211.9 29.7581 212.192 29.542C212.207 29.5312 212.221 29.5204 212.236 29.5096L210.245 26.4466L208.226 23.3404L207.448 22.1448H203.051L206.835 28.06C206.42 28.1249 205.989 28.1573 205.537 28.1573C204.114 28.1573 202.872 27.835 201.808 27.1867C200.747 26.5403 199.922 25.6129 199.337 24.4046C198.753 23.1964 198.46 21.754 198.46 20.0794C198.46 18.4047 198.753 16.9624 199.337 15.7541C199.922 14.5458 200.745 13.6185 201.808 12.972C202.87 12.3256 204.114 12.0015 205.537 12.0015C206.961 12.0015 208.203 12.3256 209.267 12.972C210.328 13.6185 211.148 14.5458 211.721 15.7541C212.295 16.9624 212.582 18.4047 212.582 20.0794C212.582 21.754 212.295 23.1964 211.721 24.4046C211.691 24.4695 211.658 24.5343 211.626 24.5973L213.844 28.0078C214.334 27.4352 214.762 26.7996 215.13 26.1045C216.043 24.3776 216.502 22.3681 216.502 20.0776C216.502 17.7871 216.043 15.8099 215.13 14.0831L215.128 14.0867Z"
                    fill="currentColor"
                  />
                  <path
                    d="M181.748 15.1852V11.3047H179.422L179.07 15.1852H176.266V17.4433H179.07V26.3801V31.215H181.748V30.9521V17.4433H185.126V15.1852H181.748Z"
                    fill="currentColor"
                  />
                  <path
                    d="M128.027 15.1852V11.3047H125.701L125.351 15.1852H122.547V17.4433H125.351V26.3801V31.215H128.027V30.9521V17.4433H131.407V15.1852H128.027Z"
                    fill="currentColor"
                  />
                </g>
                <defs>
                  <clipPath id="clip0_2872_2243">
                    <rect
                      width="216"
                      height="41"
                      fill="currentColor"
                      transform="translate(0.5)"
                    />
                  </clipPath>
                </defs>
              </svg>
            </div>
          </div>

          {/* Right section (UserDropdown) - moves to end on large screens */}
          <div className="lg:ml-auto">
            <div className="border-1 border-[#797979] p-2 rounded-md">
              <UserDropdown />
            </div>
          </div>
        </div>
      </div>
    </header>
  );
};

export default AppHeader;
